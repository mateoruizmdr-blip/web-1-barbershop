<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mateo Barber Shop | Estilo y Precisión</title>
    
    <link href="https://fonts.googleapis.com/css2?family=Oswald:wght@400;700&family=Roboto:wght@300;400&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <style>
        :root { --gold: #d4af37; --dark: #1a1a1a; --gray: #222; }
        
        * { margin: 0; padding: 0; box-sizing: border-box; }
        
        body { 
            font-family: 'Roboto', sans-serif; 
            background-color: var(--dark); 
            color: white; 
            line-height: 1.6;
            scroll-behavior: smooth;
        }

        .container { max-width: 1100px; margin: 0 auto; padding: 0 20px; }
        .gold-text { color: var(--gold); }

        /* Navbar */
        .navbar { 
            background: rgba(0,0,0,0.95); 
            padding: 1.2rem 0; 
            position: fixed; 
            width: 100%; 
            top: 0; 
            z-index: 1000; 
            border-bottom: 1px solid var(--gold); 
        }
        .nav-container { display: flex; justify-content: space-between; align-items: center; }
        .logo { 
            font-family: 'Oswald', sans-serif; 
            font-size: 1.8rem; 
            text-decoration: none; 
            color: white; 
            font-weight: bold; 
            letter-spacing: 2px;
        }

        /* Hero Section */
        .hero { 
            height: 70vh; 
            background: linear-gradient(rgba(0,0,0,0.6), rgba(0,0,0,0.6)), 
                        url('https://images.unsplash.com/photo-1503951914875-befbb7135952?auto=format&fit=crop&w=1200&q=80'); 
            background-size: cover; 
            background-position: center; 
            display: flex; 
            align-items: center; 
            justify-content: center; 
            text-align: center; 
            padding-top: 80px; 
        }
        .hero h1 { font-family: 'Oswald', sans-serif; font-size: 3.5rem; margin-bottom: 10px; }

        /* Formulario de Reserva */
        .booking-section { padding: 100px 0; background: #111; }
        .section-title { 
            text-align: center; 
            font-family: 'Oswald', sans-serif; 
            font-size: 2.5rem; 
            margin-bottom: 40px; 
            letter-spacing: 3px;
        }
        
        .booking-container { 
            max-width: 550px; 
            margin: 0 auto; 
            background: var(--gray); 
            padding: 40px; 
            border-radius: 15px; 
            border: 1px solid #333;
            box-shadow: 0 15px 35px rgba(0,0,0,0.5);
        }

        .form-group { margin-bottom: 20px; }
        label { display: block; margin-bottom: 8px; color: #aaa; font-size: 0.9rem; text-transform: uppercase; }
        
        input, select { 
            width: 100%; 
            padding: 12px; 
            border-radius: 5px; 
            border: 1px solid #444; 
            background: #0d0d0d; 
            color: white; 
            font-size: 1rem; 
        }

        input:focus, select:focus { border-color: var(--gold); outline: none; }

        .btn-submit { 
            width: 100%;
            background: var(--gold); 
            color: black; 
            padding: 15px;
            font-weight: bold; 
            border: none; 
            border-radius: 5px;
            cursor: pointer; 
            text-transform: uppercase; 
            transition: 0.3s;
            font-size: 1rem;
            margin-top: 10px;
        }
        .btn-submit:hover { background: #b8962e; transform: translateY(-2px); }
        .btn-submit:disabled { background: #555; cursor: not-allowed; }

        #mensaje { 
            margin-top: 20px; 
            text-align: center; 
            font-weight: bold; 
            padding: 15px; 
            border-radius: 5px; 
            display: none;
        }

        /* Footer */
        footer { padding: 50px 0; text-align: center; background: #000; border-top: 1px solid #222; }
    </style>
</head>
<body>

    <nav class="navbar">
        <div class="container nav-container">
            <a href="#" class="logo">MATEO <span class="gold-text">BARBER</span></a>
        </div>
    </nav>

    <header class="hero">
        <div class="container">
            <h1>ESTILO, PRECISIÓN <br><span class="gold-text">Y ACTITUD</span></h1>
            <p>La experiencia premium que tu imagen merece.</p>
        </div>
    </header>

    <section id="booking" class="booking-section">
        <div class="container">
            <h2 class="section-title">RESERVAR <span class="gold-text">CITA</span></h2>
            
            <div class="booking-container">
                <form id="bookingForm">
                    <div class="form-group">
                        <label>Nombre Completo</label>
                        <input type="text" id="name" placeholder="Ej. Juan Pérez" required>
                    </div>

                    <div class="form-group">
                        <label>Email</label>
                        <input type="email" id="email" placeholder="juan@correo.com" required>
                    </div>

                    <div class="form-group">
                        <label>Servicio</label>
                        <select id="service" required>
                            <option value="">-- Selecciona --</option>
                            <option value="15">Corte Express (15 min) - 15€</option>
                            <option value="30">Corte y Barba (30 min) - 25€</option>
                            <option value="45">Servicio Completo (45 min) - 35€</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label>Fecha</label>
                        <input type="date" id="date" required>
                    </div>

                    <div class="form-group">
                        <label>Hora Disponible</label>
                        <select id="time" required disabled>
                            <option value="">Primero elige fecha y servicio</option>
                        </select>
                    </div>

                    <button type="submit" id="btnConfirmar" class="btn-submit">CONFIRMAR RESERVA</button>
                </form>
                <div id="mensaje"></div>
            </div>
        </div>
    </section>

    <footer>
        <div class="container">
            <p>© 2026 Mateo Barber Shop. Todos los derechos reservados.</p>
        </div>
    </footer>

    <script>
        // --- CONFIGURACIÓN DE TU WEBHOOK ---
        const URL_WEBHOOK = "https://unstormable-trothless-gilberto.ngrok-free.dev/webhook/ad75122a-497e-41ee-9d8d-3f254f51b366";

        const dateInput = document.getElementById('date');
        const serviceInput = document.getElementById('service');
        const timeSelect = document.getElementById('time');
        const mensajeDiv = document.getElementById('mensaje');
        const bookingForm = document.getElementById('bookingForm');

        // Establecer fecha mínima (hoy)
        const today = new Date().toISOString().split('T')[0];
        dateInput.setAttribute('min', today);

        // 1. CARGAR HORAS CUANDO CAMBIE FECHA O SERVICIO
        async function actualizarHoras() {
            const fecha = dateInput.value;
            const servicio = serviceInput.value;

            if (!fecha || !servicio) return;

            timeSelect.disabled = true;
            timeSelect.innerHTML = '<option>Buscando huecos...</option>';
            mensajeDiv.style.display = "none";

            try {
                // n8n debe recibir estos datos para filtrar el calendario
                const response = await fetch(`${URL_WEBHOOK}?fecha=${fecha}&servicio=${servicio}`);
                const data = await response.json();

                timeSelect.innerHTML = '<option value="">-- Elige una hora --</option>';
                
                if (data.horas && data.horas.length > 0) {
                    data.horas.forEach(h => {
                        const opt = document.createElement('option');
                        opt.value = h;
                        opt.textContent = h;
                        timeSelect.appendChild(opt);
                    });
                    timeSelect.disabled = false;
                } else {
                    timeSelect.innerHTML = '<option value="">No hay disponibilidad</option>';
                }
            } catch (error) {
                console.error("Error n8n:", error);
                mensajeDiv.textContent = "Error al conectar con la agenda.";
                mensajeDiv.style.color = "red";
                mensajeDiv.style.display = "block";
            }
        }

        dateInput.addEventListener('change', actualizarHoras);
        serviceInput.addEventListener('change', actualizarHoras);

        // 2. ENVIAR LA RESERVA FINAL
        bookingForm.addEventListener('submit', async (e) => {
            e.preventDefault();
            
            const btn = document.getElementById('btnConfirmar');
            btn.disabled = true;
            mensajeDiv.textContent = "Procesando reserva...";
            mensajeDiv.style.color = "white";
            mensajeDiv.style.display = "block";

            const payload = {
                nombre: document.getElementById('name').value,
                email: document.getElementById('email').value,
                servicio: serviceInput.options[serviceInput.selectedIndex].text,
                fecha: dateInput.value,
                hora: timeSelect.value
            };

            try {
                const res = await fetch(URL_WEBHOOK, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(payload)
                });

                if (res.ok) {
                    mensajeDiv.innerHTML = "✅ ¡Cita confirmada!<br>Te esperamos el " + payload.fecha;
                    mensajeDiv.style.color = "var(--gold)";
                    bookingForm.reset();
                    timeSelect.disabled = true;
                } else {
                    throw new Error();
                }
            } catch (err) {
                mensajeDiv.textContent = "❌ Error al guardar la cita. Inténtalo de nuevo.";
                mensajeDiv.style.color = "red";
            } finally {
                btn.disabled = false;
            }
        });
    </script>
</body>
</html>
